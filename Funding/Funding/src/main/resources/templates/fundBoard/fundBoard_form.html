<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
	<title>fundBoard_form</title>
	
	<!-- BootStrap / summernote -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">

	<!-- CSS -->
	<link rel="stylesheet" href="/css/fundBoard/fundBoard_form.css"/>

	<!-- favvicon -->
    <link rel="shortcut icon" href="/img/favicon/ms-icon-310x310.png" type="image/x-icon" />
</head>
<body>
    <!-- 홈페이지 상단 nav -->
    <header th:replace="/main/nav"></header>

	<section>
		<!-- 미지정 공연 작성 Form -->
		<form th:object="${fundBoardForm}" method="POST" enctype="multipart/form-data">
			<!-- 타이틀 -->
			<div class="title">
				<h2>미지정 펀딩</h2>
			</div>

			<!-- 카테고리 -->
			<div class="int int_cate">
				<label for="categorieName">카테고리</label>
				<select id="categorieName" th:field="*{categorieName}">
					<option th:each="categorie : ${categorieList}" th:text="${categorie.categorieName}" th:value="${categorie.categorieName}"></option>
				</select>
				<span class="errors" style="display: none">에러출력</span>
			</div>

			<!-- 공연명 -->
			<div class="int int_title">
				<label for="subject">공연명</label>
				<input type="text" id="subject" th:field="*{subject}" autocomplete="off" placeholder="제목을 입력하세요.">
				<span class="errors" style="display: none">에러출력</span>
			</div>
			
			<!-- 공연장 -->
			<div class="int int_place">
				<label for="place">공연장</label>
				<input type="text" id="place" th:field="*{place}" autocomplete="off" placeholder="장소를 입력하세요.">
				<span class="errors" style="display: none">에러출력</span>
			</div>
			
			<!-- 공연시간 -->
			<div class="int int_runtime">
				<label for="runtime">공연시간</label>
				<input type="number" id="runtime" th:field="*{runtime}" autocomplete="off" placeholder="분 단위로 입력 입력하세요.">
				<span class="errors" style="display: none">에러출력</span>
			</div>

			<!-- 펀딩기간 -->
			<div class="int int_period">
				<label for="fundDuration">펀딩기간<span>(오늘부터 시작)</span></label>
				<input type="date" id="fundDuration" th:field="*{fundDuration}" th:min="${nowTime}" autocomplete="off">
				<span class="errors" style="display: none">에러출력</span>
			</div>

			<!-- 공연일 -->
			<div class="int int_date">
				<label for="startDateTime">공연일</label>
				<input type="datetime-local" id="startDateTime" th:field="*{startDateTime}" th:min="${nowTime}">
				<span class="errors" style="display: none">에러출력</span>
			</div>
			
			<!-- 최소 펀딩 금액 -->
			<div class="int int_minFund">
				<label for="minFund">1인 최소 펀딩 금액</label>
				<input type="number" id="minFund" th:field="*{minFund}" autocomplete="off" placeholder="1인 최소 펀딩 금액을 입력하세요.">
				<span class="errors" style="display: none">에러출력</span>
			</div>

			<!-- 펀딩 목표 금액 -->
			<div class="int int_amountFund">
				<label for="fundAmount">펀딩 목표 금액</label>
				<input type="number" id="fundAmount" th:field="*{fundAmount}" autocomplete="off" placeholder="펀딩 목표 금액을 입력하세요.">
				<span class="errors" style="display: none">에러출력</span>
			</div>
			
			<!-- 공연 내용(SummerNote) -->
			<div class="int int_content">
				<label for="content">공연 내용</label>
				<textarea class="content" id="summernote" th:field="*{content}" autocomplete="off"></textarea>
				<div class="errorList" style="display: none"></div>
				<span class="errors" style="display: none">에러출력</span>
			</div>
			
			<!-- 대표 이미지 선택 -->
			<label for="image">대표 이미지</label>
			<div class="int_image">
				<div class="img">
					<input id="radio1" type="radio" name="imgPath" value="https://cdn.pixabay.com/photo/2015/12/07/18/15/magic-1081149__340.jpg">
					<label for="radio1">
						<img src="https://cdn.pixabay.com/photo/2015/12/07/18/15/magic-1081149__340.jpg" alt="이미지1" width="200" heigth="200">
					</label>
				</div>

				<div class="img">
					<input id="radio2" type="radio" name="imgPath" value="https://cdn.pixabay.com/photo/2015/10/16/11/40/tarot-991041__340.jpg">
					<label for="radio2">
						<img src="https://cdn.pixabay.com/photo/2015/10/16/11/40/tarot-991041__340.jpg" alt="이미지2" width="200" heigth="200">
					</label>
				</div>

				<div class="img">
					<input id="radio3" type="radio" name="imgPath" value="https://cdn.pixabay.com/photo/2014/05/21/15/47/piano-349928__340.jpg">
					<label for="radio3">
						<img src="https://cdn.pixabay.com/photo/2014/05/21/15/47/piano-349928__340.jpg" alt="이미지3" width="200" heigth="200">
					</label>
				</div>

				<div class="img">
					<input id="radio4" type="radio" name="imgPath" value="https://cdn.pixabay.com/photo/2016/11/19/09/57/violins-1838390__340.jpg">
					<label for="radio4">
						<img src="https://cdn.pixabay.com/photo/2016/11/19/09/57/violins-1838390__340.jpg" alt="이미지4" width="200" heigth="200">
					</label>
				</div>

				<div class="img">
					<input id="radio5" type="radio" name="imgPath"
						value="https://cdn.pixabay.com/photo/2017/07/21/23/57/concert-2527495__340.jpg">
					<label for="radio5">
						<img src="https://cdn.pixabay.com/photo/2017/07/21/23/57/concert-2527495__340.jpg" alt="이미지5" width="200" heigth="200">
					</label>
				</div>
			</div>
			<!-- // 대표 이미지 선택 -->
			
			<!-- 파일 업로드 시작 -->
			<div class="int_file">
				<input type="file" multiple="multiple" name="file" />
			</div>
			<!-- 파일 업로드 끝 -->
			
			<!-- 미지정 펀딩 등록하기 -->
			<!-- 미입력시 alrt창 띄우기 -->
			<div>
				<button type="submit">등록하기</button>
			</div>
		</form>
		<!-- // 미지정 공연 작성 Form -->
    </section>
    

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
	<script src=" https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/lang/summernote-ko-KR.min.js"></script>
	
	
	<script>
		// 유효성 검사 시작
		var categorieName = document.querySelector('#categorieName'); 
		var subjec = document.querySelector('#subject');
		var place = document.querySelector('#place');
		var startDateTime = document.querySelector('#startDateTime');
		var fundDuration = document.querySelector('#fundDuration');
		var runtime = document.querySelector('#runtime');
		var minFund = document.querySelector('#minFund');
		var fundAmount = document.querySelector('#fundAmount');
		var fundAmount = document.querySelector('#fundAmount');
		var content = document.querySelector('#content');
		
		var errors = document.querySelectorAll('.errors');
		
		categorieName.addEventListener('focusout', checkCategorieName);
		subject.addEventListener('focusout', checkSubject);
		place.addEventListener('focusout', checkPlace);
		startDateTime.addEventListener('focusout', checkStartDateTime);
		fundDuration.addEventListener('focusout', checkFundDuration);
		runtime.addEventListener('focusout', checkRuntime);
		minFund.addEventListener('focusout', checkMinFund);
		fundAmount.addEventListener('focusout', checkFundAmount);
		content.addEventListener('focusout', checkContent);
		summernote.addEventListener('focusout', checkSummernote);
		
		function checkCategorieName(){
			if(categorieName.value === ""){
				errors[0].innerHTML='카테고리선택은 필수항목 입니다.';
				errors[0].style.display='block';
			}else{
				errors[0].style.display='none';
			}
		}
		
		function checkSubject(){
			if(subjec.value === ""){
				errors[1].innerHTML='공연명은 필수항목 입니다.';
				errors[1].style.display='block';
			}else{
				errors[1].style.display='none';
			}
		}

		function checkPlace(){
			if(place.value === ""){
				errors[2].innerHTML='공연장은 필수항목 입니다.';
				errors[2].style.display='block';
			}else{
				errors[2].style.display='none';
			}
		}
		
		function checkRuntime(){
			if(runtime.value === ""){
				errors[3].innerHTML='공연시간은 필수항목 입니다.'
				errors[3].style.display='block'
			}else{
				errors[3].style.display='none'
			}
		}

		function checkFundDuration(){
			if(fundDuration.value === ""){
				errors[4].innerHTML='펀딩 기간은 필수항목 입니다.'
				errors[4].style.display='block'
			}else{
				errors[4].style.display='none'
				fundTime = document.querySelector('#fundDuration').value
        		fundTime += 'T00:00'
        		startDateTime.min = fundTime
			}
		}

		function checkStartDateTime(){
			if(startDateTime.value === ""){
				errors[5].innerHTML='공연일은 필수항목 입니다.';
				errors[5].style.display='block';
			}else{
				errors[5].style.display='none';
			}
		}
		
		function checkMinFund(){
			if(minFund.value === ""){
				errors[6].innerHTML='1인 최소 펀딩 금액은 필수항목 입니다.'
				errors[6].style.display='block'
			}else if(parseInt(minFund.value) < parseInt(1000)){
				errors[6].innerHTML='1인 최소 펀딩 금액은 1000원 입니다.'
        		errors[6].style.display='block'
			}else{
				errors[6].style.display='none'
				
			}
		}
		
		function checkFundAmount(){
			if(fundAmount.value === ""){
				errors[7].innerHTML='펀딩 목표 금액은 필수항목 입니다.'
				errors[7].style.display='block'
			}else if(parseInt(minFund.field) >= parseInt(fundAmount.field)){
				error[7].innerHTML='최소 펀딩 금액보다 커야합니다.'
				error[7].style.display='block'
			}else{
				errors[7].style.display='none'
			}
		}
		
		function checkContent(){
			if(content.value === ""){
				errors[8].innerHTML='펀딩 내용은 필수항목 입니다.'
				errors[8].style.display='block'
			}else{
				errors[8].style.display='none'
			}
		}
		
		// 유효성 검사 끝
	</script>
	
	<script>	
		// 썸머노트 시작
		$(document).ready(function() {
			$('#summernote').summernote({
				height: 300,
				width: 740,
				lang: "ko-KR",
				toolbar: [
					    // [groupName, [list of button]]
				    ['fontname', ['fontname']],
				    ['fontsize', ['fontsize']],
				    ['style', ['bold', 'italic', 'underline','strikethrough', 'clear']],
				    ['color', ['forecolor','color']],
				    ['table', ['table']],
				    ['para', ['ul', 'ol', 'paragraph']],
				    ['height', ['height']],
				    ['insert',['picture','link','video']],
				    ['view', ['fullscreen', 'help']]
				  ],
				fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New','맑은 고딕','궁서','굴림체','굴림','돋움체','바탕체'],
				fontSizes: ['8','9','10','11','12','14','16','18','20','22','24','28','30','36','50','72']
				,callbacks: {	
					onImageUpload : function(files) {
						uploadSummernoteImageFile(files[0],this);
					}	
				}
			})
		})
			
		// 썸머노트 이미지 업로드
		function uploadSummernoteImageFile(file, editor) {
			var token = $("meta[name='_csrf']").attr("content");
			var header = $("meta[name='_csrf_header']").attr("content");
				
			data = new FormData();
			data.append("file", file);
			$.ajax({
				data : data,
				type : "POST",
				url : "/file/summernote/file",
				contentType : false,
				processData : false,
				beforeSend : function(xhr){
					xhr.setRequestHeader(header, token);
				},
				success : function(data) {
		            //항상 업로드된 파일의 url이 있어야 한다.
					$(editor).summernote('editor.insertImage', data);
				}
			});
		}
		// 썸머 노트 끝
	</script>
    
</body>
</html>